name: CI for betting-media.com website
on:
  push:
    branches:
      - "pipeline-update"
env:
  #ECR_REPOSITORY_BASE: 435409235876.dkr.ecr.eu-central-1.amazonaws.com/${{ vars.ECR_REPOSITORY }}
  #435409235876.dkr.ecr.eu-central-1.amazonaws.com
  IMAGE_NAME: ${{ vars.ECR_REPOSITORY }}
jobs:
  login-aws-ecr:
    runs-on: [self-hosted, linux, x64, lasha]
    steps:      
    - uses: actions/checkout@v3
      env:
        SSH_AUTH_SOCK: ${{ steps.lasha.outputs.SSH_AUTH_SOCK }}
      with:
        repository: 'Optimogroupio/racoon-argocd-test'
        path: './racoon-argocd-test'
        ref: 'master'
        ssh-key: ${{ secrets.ARGOCD_ACCESS_KEY }}

    - name: Build image
      run: docker build . --file Dockerfile --tag $IMAGE_NAME

